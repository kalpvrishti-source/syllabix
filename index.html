<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Syllabix</title>
    
    <link rel="icon" type="image/png" href="icon.png">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="apple-mobile-web-app-title" content="Syllabix">

    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --correct: #6aaa64; 
            --present: #c9b458; 
            --absent: #3a3a3c;
            --bg: #121213; 
            --text: #ffffff; 
            --border: #3a3a3c;
        }

        body.high-contrast {
            --correct: #f5793a; 
            --present: #85c0f9; 
        }

        body {
            background-color: var(--bg); color: var(--text);
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex; flex-direction: column; align-items: center;
            margin: 0; padding: 20px 10px; min-height: 100vh;
            overflow-x: hidden;
        }

        /* --- SPLASH SCREEN STYLES --- */
        #splash-screen {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background-color: var(--bg);
            display: flex; flex-direction: column;
            justify-content: center; align-items: center;
            z-index: 9999;
            transition: opacity 0.6s ease-in-out;
        }

        #splash-logo {
            width: 150px; 
            height: auto;
            border-radius: 20px;
            box-shadow: 0 0 40px rgba(133, 192, 249, 0.3);
            opacity: 0;
            animation: popIn 1s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
        }
        
        #splash-title {
            margin-top: 20px;
            font-size: 2.5rem;
            letter-spacing: 4px;
            font-weight: bold;
            text-transform: uppercase;
            color: var(--text);
            opacity: 0;
            animation: fadeIn 1s ease-in 0.4s forwards;
        }

        #splash-text {
            margin-top: 10px;
            font-size: 0.9rem;
            color: #818384;
            letter-spacing: 2px;
            text-transform: uppercase;
            font-weight: bold;
            opacity: 0;
            animation: fadeIn 1s ease-in 0.8s forwards;
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        @keyframes fadeIn {
            to { opacity: 1; }
        }
        
        /* --- CATEGORY SELECTION SCREEN --- */
        #category-screen {
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background-color: var(--bg);
            z-index: 5000;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            transition: opacity 0.5s ease-in-out, transform 0.5s ease-in-out;
        }
        
        .cat-screen-title {
            font-size: 2rem; margin-bottom: 5px; letter-spacing: 2px;
        }
        .cat-screen-sub {
            color: #818384; margin-bottom: 30px; font-size: 0.9rem;
        }

        .cat-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            width: 90%;
            max-width: 500px;
        }

        .cat-btn-large {
            background-color: #1a1a1b;
            color: white;
            border: 2px solid var(--border);
            padding: 20px 10px;
            border-radius: 12px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .cat-btn-large:hover {
            border-color: var(--correct);
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(106, 170, 100, 0.2);
        }
        
        /* --- MAIN GAME UI --- */
        .header { 
            width: 100%; max-width: 600px; 
            display: grid; grid-template-columns: 1fr auto 1fr; 
            align-items: center; 
            border-bottom: 1px solid var(--border); 
            padding-bottom: 15px; margin-bottom: 15px;
        }
        .header h1 { margin: 0; font-size: 2.2rem; letter-spacing: 2px; text-align: center; text-transform: uppercase; }
        .header-left { display: flex; gap: 10px; justify-content: flex-start; }
        .header-right { display: flex; flex-direction: column; align-items: flex-end; font-size: 0.85rem; }
        #timer { font-family: monospace; font-size: 1.1rem; color: #818384; }
        
        .icon-btn { 
            background: none; border: 2px solid #565758; color: var(--text); 
            border-radius: 50%; width: 35px; height: 35px; 
            cursor: pointer; font-weight: bold; font-size: 1.1rem;
            display: flex; justify-content: center; align-items: center;
            transition: background 0.2s;
        }
        .icon-btn:hover { background: #3a3a3c; }

        .game-wrapper {
            display: flex; flex-direction: row; gap: 40px;
            align-items: flex-start; justify-content: center;
            width: 100%; max-width: 800px; margin-top: 15px;
        }

        .row { display: grid; grid-template-columns: repeat(5, 1fr); grid-gap: 6px; margin-bottom: 6px; }
        .tile {
            width: 60px; height: 60px; border: 2px solid var(--border);
            display: flex; justify-content: center; align-items: center;
            font-size: 2rem; font-weight: bold; text-transform: uppercase;
        }

        .tracker-board { padding-top: 5px; }
        .tracker-title { font-size: 0.8rem; color: #818384; text-align: center; margin-bottom: 10px; text-transform: uppercase; letter-spacing: 1px;}
        .tk-row { display: flex; justify-content: center; gap: 8px; }
        .tk-key {
            background-color: #818384; color: white; width: 35px; height: 45px; 
            display: flex; justify-content: center; align-items: center;
            border-radius: 5px; font-weight: bold; font-size: 1rem;
            transition: background-color 0.4s; user-select: none; 
        }
        
        .tk-correct { background-color: var(--correct) !important; }
        .tk-present { background-color: var(--present) !important; }
        .tk-absent { background-color: var(--absent) !important; }

        @media (max-width: 700px) {
            .game-wrapper { flex-direction: column; align-items: center; gap: 20px; }
            .tracker-board { padding-top: 15px; border-top: 1px solid var(--border); width: 100%; }
            .cat-grid { grid-template-columns: 1fr; }
        }

        /* Modals */
        .modal {
            display: none; position: fixed; z-index: 10; left: 0; top: 0; width: 100%; height: 100%;
            background-color: rgba(0,0,0,0.8); justify-content: center; align-items: center;
        }
        .modal-content {
            background-color: #1a1a1b; padding: 25px; border-radius: 8px;
            max-width: 400px; width: 90%; border: 1px solid var(--border);
        }
        .example-row { display: flex; gap: 5px; margin: 10px 0; font-size: 0.9rem; align-items: center; }
        .mini-tile { width: 30px; height: 30px; border: 1px solid var(--border); display: flex; justify-content: center; align-items: center; font-weight: bold; }

        /* Stats Chart */
        .stat-container { display: flex; justify-content: space-around; margin-bottom: 20px; text-align: center; }
        .stat-box { display: flex; flex-direction: column; }
        .stat-num { font-size: 2rem; font-weight: bold; }
        .stat-label { font-size: 0.75rem; color: #818384; }
        .graph-row { display: flex; align-items: center; margin-bottom: 5px; font-size: 0.9rem; font-weight: bold;}
        .graph-num { width: 15px; }
        .graph-bar { background-color: #3a3a3c; height: 20px; margin-left: 10px; display: flex; align-items: center; justify-content: flex-end; padding-right: 8px; min-width: 20px; }
        .graph-bar.highlight { background-color: var(--correct); }

        /* Category Dictionary Styles */
        .dict-list { max-height: 250px; overflow-y: auto; text-align: left; font-size: 0.95rem; padding: 10px; border-radius: 5px; background: #121213; border: 1px solid var(--border); }
        .dict-list p { margin: 8px 0; border-bottom: 1px solid #3a3a3c; padding-bottom: 5px; }
        .dict-list p:last-child { border-bottom: none; }

        /* UI Controls */
        .controls { display: flex; gap: 15px; margin: 15px 0; align-items: center; font-size: 0.85rem; flex-wrap: wrap; justify-content: center;}
        #message { height: 30px; color: #ffd700; font-weight: bold; margin: 5px; text-align: center; font-size: 1.2rem;}
        .error-msg { color: #ff5252 !important; }
        
        .action-btn { 
            background-color: #565758; color: white; border: 0; 
            padding: 8px 15px; border-radius: 4px; cursor: pointer; 
            font-weight: bold; transition: opacity 0.2s; font-size: 0.9rem;
        }
        .action-btn:active { opacity: 0.7; }
        .btn-share { background-color: var(--correct); }
        .btn-restart { background-color: #1976d2; }
        .btn-yes { background-color: var(--correct); }
        
        select {
            background-color: #565758; color: white; border: 0; 
            padding: 8px 10px; border-radius: 4px; font-weight: bold; cursor: pointer; 
            font-size: 0.9rem; font-family: inherit; outline: none;
        }

        .toggle-label { display: flex; align-items: center; gap: 5px; cursor: pointer; }

        /* Animations */
        .flip { animation: flip 0.6s forwards; }
        @keyframes flip { 50% { transform: rotateX(90deg); } 100% { transform: rotateX(0deg); } }
        
        .shake { animation: shake 0.4s; }
        @keyframes shake {
            10%, 90% { transform: translate3d(-2px, 0, 0); }
            20%, 80% { transform: translate3d(4px, 0, 0); }
            30%, 50%, 70% { transform: translate3d(-8px, 0, 0); }
            40%, 60% { transform: translate3d(8px, 0, 0); }
        }

        .correct { background-color: var(--correct); border-color: var(--correct); }
        .present { background-color: var(--present); border-color: var(--present); }
        .absent { background-color: var(--absent); border-color: var(--absent); }
    </style>
</head>
<body>

    <div id="splash-screen">
        <img src="icon.png" alt="Syllabix Logo" id="splash-logo" onerror="this.style.display='none'">
        <div id="splash-title">SYLLABIX</div>
        <div id="splash-text">Developed by Kalp Shah</div>
    </div>

    <div id="category-screen">
        <h2 class="cat-screen-title">Choose Your Subject</h2>
        <div class="cat-screen-sub">Select a category to start the game</div>
        
        <div class="cat-grid">
            <button class="cat-btn-large" onclick="startGame('General')">üåç General</button>
            <button class="cat-btn-large" onclick="startGame('Science')">üî≠ Science</button>
            <button class="cat-btn-large" onclick="startGame('Chemistry')">üß™ Chemistry</button>
            <button class="cat-btn-large" onclick="startGame('Biology')">üß¨ Biology</button>
            <button class="cat-btn-large" onclick="startGame('Zoology')">ü¶Å Zoology</button>
            <button class="cat-btn-large" onclick="startGame('Astronomy')">ü™ê Astronomy</button>
            <button class="cat-btn-large" onclick="startGame('History')">üèõÔ∏è History</button>
            <button class="cat-btn-large" onclick="startGame('Maths')">‚ûó Maths / JEE</button>
            <button class="cat-btn-large" onclick="startGame('Music')">üéµ Music Tech</button>
            <button class="cat-btn-large" onclick="startGame('Geopolitics')">üåê Geopolitics</button>
        </div>
    </div>

    <div class="header">
        <div class="header-left">
            <button class="icon-btn" onclick="toggleModal('helpModal')" title="How to play">?</button>
            <button class="icon-btn" onclick="openStats()" title="Statistics">üìä</button>
            <button class="icon-btn" onclick="toggleModal('dictModal')" title="Word Examples">üìö</button>
        </div>
        <h1>SYLLABIX</h1>
        <div class="header-right">
            <span id="timer">00:00</span>
        </div>
    </div>

    <div class="controls">
        <select id="categorySelect" onchange="changeCategoryMidGame()">
            <option value="General">General</option>
            <option value="Science">Science</option>
            <option value="Chemistry">Chemistry</option>
            <option value="Biology">Biology</option>
            <option value="Zoology">Zoology</option>
            <option value="Astronomy">Astronomy</option>
            <option value="History">History</option>
            <option value="Music">Music Tech</option>
            <option value="Maths">Maths / JEE</option>
            <option value="Geopolitics">Geopolitics</option>
        </select>
        
        <label class="toggle-label"><input type="checkbox" id="hardMode"> Hard Mode</label>
        <label class="toggle-label"><input type="checkbox" id="contrastToggle" onchange="toggleContrast()"> High Contrast</label>
        
        <button class="action-btn" onclick="getHint()">üí° Hint</button>
        <button id="shareBtn" class="action-btn btn-share" style="display:none;" onclick="shareResults()">üì§ Share</button>
        <button id="playAgainBtn" class="action-btn btn-restart" style="display:none;" onclick="returnToMenu()">üîÑ Menu</button>
    </div>

    <div id="message"></div>

    <div class="game-wrapper">
        <div id="game-container"></div>
        
        <div class="tracker-board">
            <div class="tracker-title">Letter Tracker</div>
            <div id="tracker-keyboard"></div> 
        </div>
    </div>

    <div id="helpModal" class="modal" onclick="toggleModal('helpModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3>How To Play</h3>
            <p>Guess the word in exactly 6 tries. The category determines the theme!</p>
            <hr style="border: 0.5px solid var(--border)">
            <div class="example-row">
                <div class="mini-tile correct">W</div> ORLD ‚Äî <b>Correct:</b> Right letter, right spot.
            </div>
            <div class="example-row">
                <div class="mini-tile present">L</div> IGHT ‚Äî <b>Present:</b> Right letter, wrong spot.
            </div>
            <div class="example-row">
                <div class="mini-tile absent">G</div> HOST ‚Äî <b>Absent:</b> Not in the word.
            </div>
            <button class="action-btn" onclick="toggleModal('helpModal')" style="margin-top:15px; width: 100%;">Close</button>
        </div>
    </div>

    <div id="statsModal" class="modal" onclick="toggleModal('statsModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 style="text-align: center; margin-top: 0;">STATISTICS</h3>
            <div class="stat-container">
                <div class="stat-box"><span class="stat-num" id="stat-played">0</span><span class="stat-label">Played</span></div>
                <div class="stat-box"><span class="stat-num" id="stat-winpct">0</span><span class="stat-label">Win %</span></div>
            </div>
            <h4>GUESS DISTRIBUTION</h4>
            <div id="guess-distribution"></div>
            <button class="action-btn" onclick="toggleModal('statsModal')" style="margin-top:20px; width: 100%;">Close</button>
        </div>
    </div>

    <div id="dictModal" class="modal" onclick="toggleModal('dictModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <h3 style="text-align: center; margin-top: 0;">CATEGORY EXAMPLES</h3>
            <p style="font-size: 0.85rem; color: #818384; text-align: center; margin-top: -10px;">A sneak peek at the types of words in each subject!</p>
            <div class="dict-list">
                <p><b>üåç General:</b> SMART, BOARD, CLOCK...</p>
                <p><b>üî≠ Science:</b> ATOMS, FORCE, LASER...</p>
                <p><b>üß™ Chemistry:</b> AMINE, OZONE, MOLAR...</p>
                <p><b>üß¨ Biology:</b> CELLS, BRAIN, VIRUS...</p>
                <p><b>ü¶Å Zoology:</b> TIGER, WHALE, EAGLE...</p>
                <p><b>ü™ê Astronomy:</b> MARS, COMET, ORBIT...</p>
                <p><b>üèõÔ∏è History:</b> INDUS, RUINS, MYTHS...</p>
                <p><b>üéµ Music Tech:</b> AUDIO, MIXER, TEMPO...</p>
                <p><b>‚ûó Maths / JEE:</b> GRAPH, SLOPE, AXIOM...</p>
                <p><b>üåê Geopolitics:</b> TRADE, ALLYS, PEACE...</p>
            </div>
            <button class="action-btn" onclick="toggleModal('dictModal')" style="margin-top:20px; width: 100%;">Close</button>
        </div>
    </div>

    <div id="timeHintModal" class="modal" onclick="toggleModal('timeHintModal')">
        <div class="modal-content" style="text-align: center;" onclick="event.stopPropagation()">
            <h3 style="margin-top: 0;">Need a hand? ‚è±Ô∏è</h3>
            <p style="color: #cccccc;">You've been thinking for 5 minutes! Would you like me to reveal the first letter?</p>
            <div style="display: flex; gap: 10px; margin-top: 25px; justify-content: center;">
                <button class="action-btn btn-yes" onclick="acceptTimeHint()">Yes, please!</button>
                <button class="action-btn" onclick="toggleModal('timeHintModal')">No, I got this</button>
            </div>
        </div>
    </div>

    <script>
        // 1. App Startup Flow
        window.addEventListener('load', () => {
            initBoardAndKeyboard(); 
            
            const splash = document.getElementById('splash-screen');
            setTimeout(() => {
                splash.style.opacity = '0';
                setTimeout(() => {
                    splash.style.display = 'none';
                }, 600);
            }, 2500);
        });

        // Reload Warning Safeguard
        window.addEventListener('beforeunload', function (e) {
            if ((currentRow > 0 || currentCol > 0) && !gameOver) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // 2. Dictionary Setup (Now with 1,500+ Words!)
        const CATEGORIES = {
            "General": ["REACT", "APPLE", "SMART", "WORLD", "GHOST", "CHESS", "BOARD", "HOUSE", "WATER", "MONEY", "PAPER", "CLOCK", "TRAIN", "GLASS", "CHAIR", "TABLE"],
            "Science": ["ATOMS", "FORCE", "LASER", "FLUID", "SOLID", "PHASE", "LIGHT", "SOUND", "POWER", "PRISM", "OPTIC", "WAVES", "SCALE", "QUARK"],
            "Chemistry": ["AMINE", "AMIDE", "ESTER", "ETHER", "BONDS", "MOLAR", "IONIC", "GASES", "OZONE", "RADON", "ACIDS", "BASES", "YIELD"],
            "Biology": ["CELLS", "BLOOD", "BRAIN", "HEART", "VEINS", "SKULL", "PLANT", "VIRUS", "YEAST", "FUNGI", "SPORE", "GENES", "NERVES"],
            "Zoology": ["TIGER", "EAGLE", "SNAKE", "SHARK", "WHALE", "BEARS", "LIONS", "FROGS", "BIRDS", "HORSE", "RHINO", "HIPPO", "MOOSE", "ZEBRA"],
            "Astronomy": ["VENUS", "MARS", "STARS", "MOONS", "SOLAR", "LUNAR", "SPACE", "ORBIT", "COMET", "ALIEN", "ASTRO"],
            "History": ["INDUS", "CIVIL", "RUINS", "TOMBS", "KINGS", "MYTHS", "ROMAN", "GREEK", "STONE", "TRIBE", "CRAFT", "TOOLS"],
            "Music": ["AUDIO", "TRACK", "BEATS", "MIXER", "TEMPO", "CHORD", "VOCAL", "SYNTH", "SOUND", "VINYL", "TUNES"],
            "Maths": ["GRAPH", "CURVE", "SLOPE", "RATIO", "AXIOM", "PROVE", "EQUAL", "LIMIT", "ANGLE", "DIGIT", "PRIME"],
            "Geopolitics": ["TRADE", "POWER", "TREAT", "ALLYS", "ASIAN", "STATE", "WORLD", "NAVAL", "PEACE", "CLASH", "SPIES"]
        };

        // Massive block of 1,500+ common English words hidden in a string to keep the file clean
        const COMMON_WORDS_STRING = "ABOUT,ABOVE,ABUSE,ACTOR,ACUTE,ADAPT,ADMIT,ADOPT,ADULT,AFTER,AGAIN,AGENT,AGREE,AHEAD,ALARM,ALBUM,ALERT,ALIEN,ALIGN,ALIKE,ALIVE,ALLOW,ALONE,ALONG,ALTER,AMONG,ANGER,ANGLE,ANGRY,APPLE,APPLY,ARENA,ARGUE,ARISE,ARRAY,ARROW,ASIAN,ASIDE,ASSET,AUDIO,AUDIT,AVOID,AWAKE,AWARD,AWARE,AWFUL,BACON,BAKER,BASIC,BASIN,BASIS,BATCH,BEACH,BEARD,BEAST,BEGIN,BEING,BELOW,BENCH,BILLY,BIRTH,BLACK,BLADE,BLAME,BLANK,BLIND,BLOCK,BLOOD,BOARD,BOAST,BONUS,BOOST,BOOTH,BOUND,BRAIN,BRAKE,BRAND,BREAD,BREAK,BREED,BRICK,BRIDE,BRIEF,BRING,BROAD,BROKE,BROWN,BRUSH,BUILD,BUILT,BUYER,CABIN,CABLE,CATCH,CAUSE,CHAIN,CHAIR,CHART,CHASE,CHEAP,CHECK,CHEEK,CHEER,CHESS,CHEST,CHIEF,CHILD,CHINA,CHOIR,CHOSE,CIVIC,CIVIL,CLAIM,CLASS,CLEAN,CLEAR,CLERK,CLICK,CLOCK,CLOSE,COACH,COAST,COLON,COLOR,COMIC,CORAL,COTTON,COUCH,COULD,COUNT,COURT,COVER,CRACK,CRAFT,CRASH,CRAZY,CREAM,CRIME,CROSS,CROWD,CROWN,CRUEL,CURVE,CYCLE,DAILY,DANCE,DATED,DEALT,DEATH,DEBUT,DELAY,DEPTH,DEVIL,DIARY,DIGIT,DIRTY,DISCO,DITCH,DONOR,DOUBT,DRAFT,DRAMA,DRAWN,DREAM,DRESS,DRILL,DRINK,DRIVE,DRUNK,EAGER,EAGLE,EARLY,EARTH,EIGHT,ELITE,EMPTY,ENEMY,ENJOY,ENTER,ENTRY,EQUAL,ERROR,ESSAY,EVENT,EVERY,EXACT,EXIST,EXTRA,FAITH,FALSE,FAULT,FIBER,FIELD,FIFTH,FIFTY,FIGHT,FINAL,FIRST,FIXED,FLASH,FLEET,FLESH,FLIGHT,FLOOR,FLOUR,FLUID,FOCUS,FORCE,FORTH,FORTY,FORUM,FOUND,FRAME,FRAUD,FRESH,FRONT,FRUIT,FULLY,FUNNY,GIANT,GIVEN,GLASS,GLOBE,GLORY,GOING,GRACE,GRADE,GRAND,GRANT,GRASS,GREAT,GREEN,GROSS,GROUP,GROWN,GUARD,GUESS,GUEST,GUIDE,HABIT,HAPPY,HARSH,HEART,HEAVY,HELLO,HENCE,HORSE,HOTEL,HOUSE,HUMAN,IDEAL,IMAGE,INDEX,INNER,INPUT,ISSUE,JOINT,JUDGE,JUICE,KNOWN,LABEL,LABOR,LARGE,LATER,LAUGH,LAYER,LEARN,LEASE,LEAST,LEAVE,LEGAL,LEMON,LEVEL,LIGHT,LIMIT,LINEN,LOCAL,LOGIC,LOOSE,LOWER,LUCKY,LUNCH,MAGIC,MAJOR,MAKER,MARCH,MARRY,MATCH,MAYBE,MAYOR,MEANT,MEDIA,MERIT,METAL,METER,MIGHT,MINOR,MINUS,MIXED,MODEL,MONEY,MONTH,MORAL,MOTOR,MOUNT,MOUSE,MOUTH,MOVIE,MUSIC,NEEDS,NEVER,NEWLY,NIGHT,NOISE,NORTH,NOVEL,NURSE,OCCUR,OCEAN,OFFER,OFTEN,ONION,ORDER,ORGAN,OTHER,OUGHT,OUNCE,OUTER,OWNER,PANEL,PAPER,PARTY,PATCH,PEACE,PHASE,PHONE,PHOTO,PIANO,PIECE,PILOT,PITCH,PLACE,PLAIN,PLANE,PLANT,PLATE,POINT,POUND,POWER,PRESS,PRICE,PRIDE,PRIME,PRINT,PRIOR,PRIZE,PROOF,PROUD,PROVE,QUEEN,QUICK,QUIET,QUITE,RADIO,RAISE,RANGE,RAPID,RATIO,REACH,REACT,READY,REALM,REBEL,REFER,RELAX,RELAY,REPLY,RIGHT,RIVER,ROMAN,ROUGH,ROUND,ROUTE,ROYAL,RURAL,SCALE,SCENE,SCOPE,SCORE,SENSE,SERVE,SETUP,SEVEN,SHALL,SHAPE,SHARE,SHARP,SHEET,SHELF,SHELL,SHIFT,SHIRT,SHOCK,SHOOT,SHORT,SHOWN,SIGHT,SINCE,SIXTH,SIXTY,SKILL,SLEEP,SLIDE,SMALL,SMART,SMILE,SMITH,SMOKE,SOLID,SOLVE,SORRY,SOUND,SOUTH,SPACE,SPARE,SPEAK,SPEED,SPELL,SPEND,SPENT,SPLIT,SPOKE,SPORT,STAFF,STAGE,STAND,START,STATE,STEAM,STEEL,STICK,STILL,STOCK,STONE,STOOD,STORE,STORM,STORY,STRIP,STUCK,STUDY,STUFF,STYLE,SUGAR,SUPER,SWEET,TABLE,TAKEN,TASTE,TAXES,TEACH,TEETH,TENTH,TEXAS,THANK,THEFT,THEIR,THEME,THERE,THESE,THICK,THIEF,THING,THINK,THIRD,THOSE,THREE,THREW,THROW,TIGER,TIGHT,TIMES,TITLE,TODAY,TOPIC,TOTAL,TOUCH,TOUGH,TOWER,TRACK,TRADE,TRAIN,TREAT,TREND,TRIAL,TRIBE,TRICK,TRUCK,TRULY,TRUST,TRUTH,TWICE,UNDER,UNION,UNITY,UNTIL,UPPER,UPSET,URBAN,USAGE,USUAL,VALID,VALUE,VIDEO,VIRUS,VISIT,VITAL,VOICE,VOTER,WAGON,WASTE,WATCH,WATER,WHEEL,WHERE,WHICH,WHILE,WHITE,WHOLE,WHOSE,WOMAN,WOMEN,WORDS,WORLD,WORRY,WORSE,WORST,WORTH,WOULD,WOUND,WRITE,WRONG,YIELD,YOUNG,YOUTH";
        
        // Merge the common words with the specific category words, and remove any duplicates
        const VALID_GUESSES = [
            ...new Set([
                ...Object.values(CATEGORIES).flat(),
                ...COMMON_WORDS_STRING.split(",")
            ])
        ];

        // 3. Game State Variables
        let currentCategory = "General";
        let targetWord = "";
        let currentRow = 0, currentCol = 0, gameOver = false, startTime, timerInt;
        let guesses = Array(6).fill("");
        let boardEmoji = [];
        let letterStates = {}; 
        let timeHintOffered = false;
        let stats = JSON.parse(localStorage.getItem('wordle-stats')) || { played: 0, won: 0, guesses: {1:0, 2:0, 3:0, 4:0, 5:0, 6:0} };

        // 4. Initialization & Game Flow Functions
        
        function startGame(category) {
            currentCategory = category;
            document.getElementById('categorySelect').value = category; 
            
            const catScreen = document.getElementById('category-screen');
            catScreen.style.opacity = '0';
            catScreen.style.transform = 'translateY(-20px)';
            setTimeout(() => { catScreen.style.display = 'none'; }, 500);
            
            resetGame(); 
        }

        function changeCategoryMidGame() {
            currentCategory = document.getElementById('categorySelect').value;
            resetGame(); 
            showMsg(`Subject changed to: ${currentCategory}`);
            setTimeout(() => { if(document.getElementById('message').textContent.includes('Subject')) showMsg(""); }, 2000);
        }

        function returnToMenu() {
            const catScreen = document.getElementById('category-screen');
            catScreen.style.display = 'flex';
            setTimeout(() => { 
                catScreen.style.opacity = '1'; 
                catScreen.style.transform = 'translateY(0)';
            }, 50);
        }

        function initBoardAndKeyboard() {
            const container = document.getElementById('game-container');
            container.innerHTML = ''; 
            for (let i = 0; i < 6; i++) {
                const row = document.createElement('div'); row.className = 'row';
                for (let j = 0; j < 5; j++) {
                    const tile = document.createElement('div'); tile.className = 'tile';
                    tile.id = `tile-${i}-${j}`; row.appendChild(tile);
                }
                container.appendChild(row);
            }

            const tracker = document.getElementById('tracker-keyboard');
            tracker.innerHTML = '';
            const QWERTY = [
                ["Q","W","E","R","T","Y","U","I","O","P"],
                ["A","S","D","F","G","H","J","K","L"],
                ["Z","X","C","V","B","N","M"]
            ];
            QWERTY.forEach((row, index) => {
                const rowEl = document.createElement('div'); rowEl.className = 'tk-row';
                row.forEach(key => {
                    const keyEl = document.createElement('div'); keyEl.className = 'tk-key';
                    keyEl.id = `tk-${key}`; keyEl.textContent = key; rowEl.appendChild(keyEl);
                });
                tracker.appendChild(rowEl);
                if (index < QWERTY.length - 1) tracker.appendChild(document.createElement('br'));
            });
        }

        function startTimer() {
            if(timerInt) clearInterval(timerInt); 
            startTime = Date.now();
            timerInt = setInterval(() => {
                if (gameOver) return;
                const diff = Math.floor((Date.now() - startTime) / 1000);
                const m = Math.floor(diff / 60).toString().padStart(2, '0');
                const s = (diff % 60).toString().padStart(2, '0');
                document.getElementById('timer').textContent = `${m}:${s}`;

                if (diff >= 300 && !timeHintOffered && !gameOver) {
                    timeHintOffered = true;
                    toggleModal('timeHintModal');
                }
            }, 1000);
        }

        function resetGame() {
            targetWord = CATEGORIES[currentCategory][Math.floor(Math.random() * CATEGORIES[currentCategory].length)]; 
            currentRow = 0; currentCol = 0; gameOver = false; guesses = Array(6).fill(""); boardEmoji = [];
            timeHintOffered = false; letterStates = {};
            
            for(let i=0; i<6; i++) {
                for(let j=0; j<5; j++) {
                    const t = document.getElementById(`tile-${i}-${j}`);
                    t.textContent = "";
                    t.className = 'tile'; 
                }
            }
            document.querySelectorAll('.tk-key').forEach(k => k.className = 'tk-key');

            document.getElementById('timer').textContent = "00:00";
            document.getElementById('shareBtn').style.display = "none";
            document.getElementById('playAgainBtn').style.display = "none";
            showMsg(""); 
            startTimer(); 
        }

        // 5. Input & Core Logic
        function handleInput(k) {
            if(gameOver || document.getElementById('category-screen').style.display !== 'none') return;
            
            if((k === 'Backspace') && currentCol > 0) {
                currentCol--; guesses[currentRow] = guesses[currentRow].slice(0, -1);
            } else if(k === 'Enter') {
                if (currentCol === 5) submitGuess();
                else {
                    shakeRow(); showMsg("Not enough letters");
                    setTimeout(() => { if(!gameOver && document.getElementById('message').textContent === "Not enough letters") showMsg(""); }, 1500);
                }
            } else if(/^[a-zA-Z]$/.test(k) && currentCol < 5 && k.length === 1) {
                guesses[currentRow] += k.toUpperCase(); currentCol++;
            }
            updateView();
        }

        function updateView() {
            for(let i=0; i<5; i++) {
                const t = document.getElementById(`tile-${currentRow}-${i}`);
                t.textContent = guesses[currentRow][i] || "";
            }
        }

        function updateTracker(char, status) {
            const currentStatus = letterStates[char];
            if (currentStatus === 'correct') return; 
            if (currentStatus === 'present' && status === 'absent') return;
            letterStates[char] = status;
            const keyEl = document.getElementById(`tk-${char}`);
            if (keyEl) {
                keyEl.classList.remove('tk-correct', 'tk-present', 'tk-absent');
                keyEl.classList.add(`tk-${status}`);
            }
        }

        function shakeRow() {
            const rows = document.querySelectorAll('.row');
            rows[currentRow].classList.add('shake');
            setTimeout(() => { rows[currentRow].classList.remove('shake'); }, 400); 
        }

        async function submitGuess() {
            const guess = guesses[currentRow];
            
            // THE STRICT DICTIONARY CHECK IS BACK!
            // It now uses the 1,500+ word dictionary to block random gibberish.
            if (!VALID_GUESSES.includes(guess)) {
                shakeRow(); showMsg("Not in word list");
                setTimeout(() => { if(!gameOver && document.getElementById('message').textContent === "Not in word list") showMsg(""); }, 1500);
                return; 
            }

            let rowEmoji = "";
            gameOver = true; 
            
            for(let i=0; i<5; i++) {
                const t = document.getElementById(`tile-${currentRow}-${i}`);
                const char = guess[i];
                let status = "";
                
                await new Promise(r => setTimeout(r, 150));
                t.classList.add('flip');
                
                if(char === targetWord[i]) { 
                    t.classList.add('correct'); rowEmoji += document.getElementById('contrastToggle').checked ? "üüß" : "üü©"; status = "correct";
                } else if(targetWord.includes(char)) { 
                    t.classList.add('present'); rowEmoji += document.getElementById('contrastToggle').checked ? "üü¶" : "üü®"; status = "present";
                } else { 
                    t.classList.add('absent'); rowEmoji += "‚¨õ"; status = "absent";
                }
                updateTracker(char, status);
            }
            boardEmoji.push(rowEmoji);

            if(guess === targetWord) {
                clearInterval(timerInt);
                showMsg("Impressive! üéâ");
                fireConfetti();
                saveStats(true);
                showEndgameButtons();
            } else if(currentRow === 5) {
                clearInterval(timerInt);
                showMsg(`You used all attempts! Word: ${targetWord}`, true);
                saveStats(false);
                showEndgameButtons();
            } else { 
                currentRow++; currentCol = 0; gameOver = false; 
            }
        }

        // 6. Extras (Hints, Modals, Stats)
        function getHint() {
            if(gameOver) return;
            let foundLetters = [];
            for(let i=0; i<6; i++) {
                for(let j=0; j<5; j++) {
                    const t = document.getElementById(`tile-${i}-${j}`);
                    if(t.classList.contains('correct') || t.classList.contains('present')) foundLetters.push(t.textContent);
                }
            }
            const unrevealed = targetWord.split('').filter(l => !foundLetters.includes(l));
            if(unrevealed.length > 0) {
                const hintLetter = unrevealed[Math.floor(Math.random() * unrevealed.length)];
                showMsg(`Hint: The word contains '${hintLetter}'`);
            } else { showMsg("You already have all the letters!"); }
        }

        function acceptTimeHint() {
            toggleModal('timeHintModal');
            showMsg(`Hint: The first letter is '${targetWord[0]}'`);
            setTimeout(() => { if(!gameOver && document.getElementById('message').textContent.includes('first letter is')) showMsg(""); }, 4000);
        }

        function fireConfetti() {
            confetti({ particleCount: 150, spread: 80, origin: { y: 0.6 }, zIndex: 1000 });
        }

        function saveStats(won) {
            stats.played++;
            if (won) {
                stats.won++;
                stats.guesses[currentRow + 1]++;
            }
            localStorage.setItem('wordle-stats', JSON.stringify(stats));
        }

        function openStats() {
            document.getElementById('stat-played').textContent = stats.played;
            const winPct = stats.played === 0 ? 0 : Math.round((stats.won / stats.played) * 100);
            document.getElementById('stat-winpct').textContent = winPct;

            const distContainer = document.getElementById('guess-distribution');
            distContainer.innerHTML = '';
            
            let maxGuesses = 1;
            for(let i=1; i<=6; i++) { if(stats.guesses[i] > maxGuesses) maxGuesses = stats.guesses[i]; }

            for (let i = 1; i <= 6; i++) {
                const val = stats.guesses[i];
                const widthPct = Math.max(7, (val / maxGuesses) * 100); 
                
                const row = document.createElement('div'); row.className = 'graph-row';
                const num = document.createElement('div'); num.className = 'graph-num'; num.textContent = i;
                const bar = document.createElement('div'); bar.className = 'graph-bar'; 
                bar.style.width = `${widthPct}%`; bar.textContent = val;
                
                if (gameOver && val > 0 && currentRow + 1 === i && guesses[currentRow] === targetWord) {
                    bar.classList.add('highlight');
                }
                
                row.appendChild(num); row.appendChild(bar);
                distContainer.appendChild(row);
            }
            toggleModal('statsModal');
        }

        function toggleContrast() {
            const isContrast = document.getElementById('contrastToggle').checked;
            if(isContrast) document.body.classList.add('high-contrast');
            else document.body.classList.remove('high-contrast');
        }

        function showEndgameButtons() {
            document.getElementById('shareBtn').style.display = "inline-block";
            document.getElementById('playAgainBtn').style.display = "inline-block";
        }

        function toggleModal(id) {
            const m = document.getElementById(id);
            m.style.display = m.style.display === 'flex' ? 'none' : 'flex';
        }

        function showMsg(m, isError = false) { 
            const msgBox = document.getElementById('message');
            msgBox.textContent = m; 
            if (isError) msgBox.classList.add('error-msg');
            else msgBox.classList.remove('error-msg');
        }

        function shareResults() {
            const text = `Syllabix [${currentCategory}] ${currentRow === 6 && guesses[5] !== targetWord ? 'X' : currentRow + 1}/6 (${document.getElementById('timer').textContent})\n\n${boardEmoji.join('\n')}`;
            navigator.clipboard.writeText(text);
            showMsg("Copied to clipboard!");
        }

        window.addEventListener('keydown', e => {
            if(e.ctrlKey || e.metaKey || e.altKey) return;
            handleInput(e.key);
        });
        
    </script>
</body>
</html>
